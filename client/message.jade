template(name="message")
  if group
    +submessage
  else
    +badMessage

template(name="badMessage")
  p The message &ldquo;<b>#{message}</b>&rdquo; does not exist or you do not have permission to access it.
  unless currentUser
    p You probably need to log in.

template(name="submessage")
  .panel.panel-primary.message
    .panel-heading
      if editingRV
        input.form-control.title(type="text", placeholder="Title", value="{{title}}", data-message=_id, style="width: 100%")
      .space-between
        .unit
          unless editingRV
            span.title.tex2jax= title
            span.space
          if deleted
            span.label.label-danger Deleted
          else
            unless published
              span.label.label-warning Unpublished
        .unit
          if editingRV
            button.btn.btn-default.editButton(data-message=_id) Stop Editing
            .btn-group
              button.btn.btn-default.dropdown-toggle(type="button", data-toggle="dropdown", aria-haspopup="true", aria-expanded="false")
                | #{keyboard}
                span.caret
              ul.dropdown-menu(role="menu")
                li.editorKeyboard(class="{{activeKeyboard 'ace'}}")
                  a(href="#",data-keyboard="ace") Ace
                li.editorKeyboard(class="{{activeKeyboard 'vim'}}")
                  a(href="#",data-keyboard="vim") Vim
                li.editorKeyboard(class="{{activeKeyboard 'emacs'}}")
                  a(href="#",data-keyboard="emacs") Emacs
            .btn-group
              button.btn.btn-default.dropdown-toggle(type="button", data-toggle="dropdown", aria-haspopup="true", aria-expanded="false")
                | #{format}
                span.caret
              ul.dropdown-menu(role="menu")
                li.editorFormat(class="{{activeFormat 'html'}}")
                  a(href="#",data-format="html") HTML
                li.editorFormat(class="{{activeFormat 'markdown'}}")
                  a(href="#",data-format="markdown") Markdown
          else
            if canEdit
              button.btn.btn-default.editButton(data-message=_id) Edit
          if deleted
            if canUndelete
              button.btn.btn-success.deleteButton(data-message=_id) Undelete
            if canSuperdelete
              button.btn.btn-danger.superdeleteButton(data-message=_id) Superdelete
          else
            if published
              if canUnpublish
                button.btn.btn-danger.publishButton(data-message=_id) Unpublish
            else
              if canPublish
                button.btn.btn-success.publishButton(data-message=_id) Publish
            if canDelete
              button.btn.btn-danger.deleteButton(data-message=_id) Delete
    with nothing
      if editingRV
        //+sharejsAce docid=editingRV
        +sharejsAce docid=editingNR onRender=config
    .panel-body.tex2jax !{body}
    table.message-footer
      td
        if canReply
          button.btn.btn-default.replyButton(data-message=_id) Reply
      td.author
        if published
          | (posed by
        else
          | (created by
        | #{creator} {{formatDate created}}#{authors})
    .children
      each children
        +submessage

template(name="superdelete")
  .modal
    .modal-dialog
      .modal-content
        .modal-header
          h2 Confirm Superdelete
        .modal-body
          p Are you sure you want to delete &ldquo;#{title}&rdquo; (#{_id}) by #{creator}?
          p Superdelete destroys all logs of the message ever existing and cannot be undone.  Use only for silly mistakes.
        .modal-footer
          button.btn.btn-warning.shallowSuperdeleteButton Superdelete node, not children
          button.btn.btn-danger.deepSuperdeleteButton Recursively superdelete node and children
          button.btn.btn-success.cancelButton.fullwidth Cancel
